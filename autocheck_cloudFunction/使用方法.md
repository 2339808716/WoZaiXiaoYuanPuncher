### 说明

**注：这是云函数的版本，所有需要用到的文件都放在 `autocheck_cloudFunction` 文件夹中**。

在原有代码的基础上做了一点修改，可以实现**云函数自动打卡 + 消息提醒**。只需要在云端部署函数，本地不需要做任何处理，打卡结果会自动发送到微信上。


### 2021-8-4 更新
* 消息提醒服务从喵提醒改为 pushPlus，不需要再手动激活 48 小时
* 缓存 jwsession 到本地，避免频繁登录可能导致的账户出错问题
* 优化代码结构

### 使用方法

#### 1. 获取 pushPlus 的 token

微信搜索公众号“pushplus 推送加”，关注后即可生成属于自己的 token，后面需要用到

#### 2. 创建云函数

1）注册腾讯云账号并登录，进行实名认证

2）到 https://console.cloud.tencent.com/scf/list?rid=1&ns=default ，选择 “新建云函数” ➔ “自定义创建”，提交方法选择“本地上传文件夹”，选中 `autocheck_cloudFunction` 文件夹上传，点击“完成”即可创建云函数

#### 3. 修改配置文件

到刚才新创建的云函数中，打开 `config.json` 配置文件进行修改。

“我在校园”账号配置项说明：
* `username`：“我在校园”的账号，一般是你的手机号码
* `password`：“我在校园”的密码，忘记了打开小程序重新设置就行
* `jwsession`：初次使用该脚本的用户，这里不用动它；已经使用过该脚本并且遇到“账户出错”问题的用户，手动抓包获取最新的 jwsession 填上即可
* `temperature`：默认上报的体温为 36°C，如果你想随机上报体温，请以“36~38”的形式填写
* `latitude` 和 `longitude`：你学校的经度和纬度，通过 [腾讯地图](https://lbs.qq.com/service/webService/webServiceGuide/webServiceGeocoder) 可查
* 剩下的配置项代表你学校的地址（具体到街），手动填写即可（广财本部校区的学生，这里不用改）

“pushPlus” 账号配置项说明：
* `isEnable`: 默认 `false`，表示不开启消息提醒功能，若要开启请修改为 `true`
* `notifytoken`：之前你从 pushPlus 公众号那里获取的 token

#### 4. 部署和测试

修改完成后点击部署并测试，如果微信有收到 pushPlus 公众号发来的信息，说明设置 ok。效果如下图所示：

1）客服消息：
![](https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/pr/2.jpg)

2）模板消息：
![](https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/pr/1.jpg)

默认发送的是客服消息，如果发送的消息数量超过微信限制，则会降级为模板消息。通过给公众号发送“激活消息”的文字，可以重新激活客服消息功能。但无论是哪一种，你都是可以收到消息的，所以就算不激活也没事。

#### 5. 实现自动打卡

点击控制台左侧的“触发管理”，新建一个云函数触发器。设置如下：

![](https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/pr/image-20210802123156661.png)

触发时间使用的是 Cron 表达式，这里的意思是每天 7 点、13 点、19 点各触发（打卡）一次，可以自己修改，按照自己学校规定的打卡时间段来设置。

最后提交就可以了，以后到点了就会自动打卡并把打卡结果发到你的微信上。
